<?xml version="1.0" encoding="utf-8"?>
<openerp>
<data>
<template id="report_assistance_period_document">
 <t t-call="report.html_container">

<t t-call="report.html_container">
    <!--<t t-call="report.external_layout"/>--> <!-- llama a la cabecera para imprimir la empresa, de momento se monta...-->
    <div class="page">
    <table class="table table-condensed" style="font-size:70%;">
        <thead Style="background: #DBDBDB;">
            <th colspan="2">Company Data</th>
            <th colspan="2">Employee Data</th>
        </thead>
        <tbody>
            <td>Name:</td>
            <td><span t-esc="res_company.name"/></td>
            <td>Name:</td>
            <td colspan="2"><span t-esc="docs[0].employee_id.name"/></td>
            <tr/>
            <td>CIF:</td>
            <td><span t-esc="res_company.vat"/></td>
            <td>NIF:</td>
            <td colspan="2"><span t-esc="docs[0].employee_id.identification_id"/></td>
            <tr/>
            <td/>
            <td/>
            <td>period</td>
            <td><span t-esc="formatLang(data['form']['date_start'],date=True)"/>  //  <span t-esc="formatLang(data['form']['date_end'],date=True)"/> </td>
            <tr/>
            </tbody>   
    </table>
    <table class="table table-condensed" style="font-size:70%;">
			<thead Style="background: #DBDBDB;">
        <th>CD</th>
        <th colspan="5" Style="text-align:center">Working day</th>
				<tr/>
				<!--<th>CD</th>
				<th colspan="5">Jornada Ordinaria</th>-->
				<!--<th colspan="5">Jornada de tarde)</th>-->
				<th>Day</th>
				<th>Start time</th>
				<th>Sign</th>
				<th>End time</th>
				<th>Sign</th>
				<th>Worked hours</th>
				<!--<th>Hora inicio</th>
				<th>Firma</th>
				<th>Hora Finalizacion</th>
				<th>Firma</th>
				<th>HT</th>-->
			</thead>

<tbody>
            <td>Name:</td>
            <td><span t-esc="res_company.name"/></td>
            <td>Name:</td>
            <td colspan="2"><span t-esc="docs[0].employee_id.name"/></td>
            <tr/>
            <td>CIF:</td>
            <td><span t-esc="res_company.vat"/></td>
            <td>NIF:</td>
            <td colspan="2"><span t-esc="docs[0].employee_id.identification_id"/></td>
            <tr/>
            <td/>
            <td/>
            <td>period</td>
            <td><span t-esc="formatLang(data['form']['date_start'],date=True)"/>  //  <span t-esc="formatLang(data['form']['date_end'],date=True)"/> </td>
            <tr/>
            </tbody>   
    </table>
    <table class="table table-condensed" style="font-size:70%;">
			<thead Style="background: #DBDBDB;">
        <th>CD</th>
        <th colspan="5" Style="text-align:center">Working day</th>
				<tr/>
				<th>Day</th>
				<th>Start time</th>
				<th>Sign</th>
				<th>End time</th>
				<th>Sign</th>
				<th>Worked hours</th>
    		</thead>
			<tbody>
        <t t-set="ht" t-value="0"/>
        <t t-foreach="data['attendances']" t-as="o">
		<!--datos del turno-->		
	    
        
        <t t-set="entrada" t-value="random(o['day'],o['entrada'])"/>
        <t t-set="salida" t-value="random(o['day'],o['salida'])"/>

        
        <td><span t-esc="o['day']"/></td>
		<!--<td><t t-esc=" '%s:%02d'  %(str(o['entrada']).split('.')[0], int(round(float(str('%.2f' % o['entrada']).split('.')[1])/100*60)))"/></td>-->
     	<td><t t-esc=" '%s:%02d'  %(str(entrada).split('.')[0], int(float(str(entrada).split('.')[1][:2])/100*60))"/></td>
		<td></td>

		<!-- METODO PRECISO 00 -->
        <!--<t t-if="o['lunch'] and not o['meal']">
			<td><t t-esc=" '%s:%02d'  %(str(o['lunch_start']).split('.')[0], int(round(float(str('%.2f' % o['lunch_start']).split('.')[1])/100*60)))"/></td>
			<td/>
			<td><span t-esc="o['lunch_start']-o['entrada']"/></td>
			<t t-set="ht" t-value="ht+(o['lunch_start']-o['entrada'])"/>
			<tr>
                <td>
                <span t-esc="o['day']"/></td>
				<td><t t-esc=" '%s:%02d'  %(str(o['lunch_end']).split('.')[0], int(round(float(str('%.2f' % o['lunch_end']).split('.')[1])/100*60)))"/></td>
				<td/>
				<td><t t-esc=" '%s:%02d'  %(str(o['salida']).split('.')[0], int(round(float(str('%.2f' % o['salida']).split('.')[1])/100*60)))"/></td>
				<td/>
				<td><span t-esc="o['salida']-o['lunch_end']"/></td>
				<t t-set="ht" t-value="ht+(o['salida']-o['lunch_end'])"/>
			</tr>
		</t>-->

        <!-- METODO RANDOM -->
        <t t-if="o['lunch'] and not o['meal']">
            <t t-set="lunch_start" t-value="random(o['day'],o['lunch_start'])"/>
            <t t-set="lunch_end" t-value="random(o['day'],o['lunch_end'])"/>

            <td><t t-esc=" '%s:%02d'  %(str(lunch_start).split('.')[0], int(float(str(lunch_start).split('.')[1][:2])/100*60))"/></td>
			<td/>
			<td><span t-esc="lunch_start-entrada"/></td>
			<t t-set="ht" t-value="ht+(lunch_start-entrada)"/>
			<tr>
                <td>
                <span t-esc="o['day']"/></td>
                <td><t t-esc=" '%s:%02d'  %(str(lunch_end).split('.')[0], int(float(str(lunch_end).split('.')[1][:2])/100*60))"/></td>
				<td/>
                <td><t t-esc=" '%s:%02d'  %(str(salida).split('.')[0], int(float(str(salida).split('.')[1][:2])/100*60))"/></td>
				<td/>

                <td><t t-esc=" '%sh %02dm'  %(str((salida-lunch_end)).split('.')[0], int(float(str((salida-lunch_end)).split('.')[1][:2])/100*60))"/></td>
				<t t-set="ht" t-value="ht+(salida-lunch_end)"/>
			</tr>
		</t>

		<!-- METODO PRECISO 00 -->
		<!--<t t-if="o['meal'] and o['lunch']">
        	<td><t t-esc=" '%s:%02d'  %(str(o['lunch_start']).split('.')[0], int(round(float(str('%.2f' % o['lunch_start']).split('.')[1])/100*60)))"/></td>
			<td/>
			<td><span t-esc="o['lunch_start']-o['entrada']"/></td>
			<t t-set="ht" t-value="ht+(o['lunch_start']-o['entrada'])"/>
			<tr>
                <td>
                <span t-esc="o['day']"/></td>
				<td><t t-esc=" '%s:%02d'  %(str(o['lunch_end']).split('.')[0], int(round(float(str('%.2f' % o['lunch_end']).split('.')[1])/100*60)))"/></td>
				<td/>
				<td><t t-esc=" '%s:%02d'  %(str(o['meal_start']).split('.')[0], int(round(float(str('%.2f' % o['meal_start']).split('.')[1])/100*60)))"/></td>
				<td/>
				<td><span t-esc="o['meal_start']-o['lunch_end']"/></td>
				<t t-set="ht" t-value="ht+(o['meal_start']-o['lunch_end'])"/>
			</tr>

			<tr>
			    <td><span t-esc="o['day']"/></td>
				<td><t t-esc=" '%s:%02d'  %(str(o['meal_end']).split('.')[0], int(round(float(str('%.2f' % o['meal_end']).split('.')[1])/100*60)))"/></td>
				<td/>
				<td><t t-esc=" '%s:%02d'  %(str(o['salida']).split('.')[0], int(round(float(str('%.2f' % o['salida']).split('.')[1])/100*60)))"/></td>
				<td/>
				<td><span t-esc="o['salida']-o['meal_end']"/></td>
				<t t-set="ht" t-value="ht+(o['salida']-o['meal_end'])"/>
			</tr>
		</t>-->

        <!--METODO RANDOM -->
		<t t-if="o['meal'] and o['lunch']">
            <t t-set="lunch_start" t-value="random(o['day'],o['lunch_start'])"/>
            <t t-set="lunch_end" t-value="random(o['day'],o['lunch_end'])"/>

            <t t-set="meal_start" t-value="random(o['day'],o['meal_start'])"/>
            <t t-set="meal_end" t-value="random(o['day'],o['meal_end'])"/>


            <td><t t-esc=" '%s:%02d'  %(str(lunch_start).split('.')[0], int(float(str(lunch_start).split('.')[1][:2])/100*60))"/></td>
			<td/>
			<td><span t-esc="o['lunch_start']-o['entrada']"/></td>
			<t t-set="ht" t-value="ht+(o['lunch_start']-o['entrada'])"/>
			<tr>
                <td>
                <span t-esc="o['day']"/></td>
                <td><t t-esc=" '%s:%02d'  %(str(lunch_end).split('.')[0], int(float(str(lunch_end).split('.')[1][:2])/100*60))"/></td>

				<td/>
                <td><t t-esc=" '%s:%02d'  %(str(meal_start).split('.')[0], int(float(str(meal_start).split('.')[1][:2])/100*60))"/></td>

				<td/>
                
                <td><t t-esc=" '%sh %02dm'  %(str((meal_start-lunch_end)).split('.')[0], int(float(str((meal_start-lunch_end)).split('.')[1][:2])/100*60))"/></td>
				<t t-set="ht" t-value="ht+(meal_start-lunch_end)"/>
			</tr>

			<tr>
			    <td><span t-esc="o['day']"/></td>
                <td><t t-esc=" '%s:%02d'  %(str(meal_end).split('.')[0], int(float(str(meal_end).split('.')[1][:2])/100*60))"/></td>

				<td/>
                <td><t t-esc=" '%s:%02d'  %(str(salida).split('.')[0], int(float(str(salida).split('.')[1][:2])/100*60))"/></td>

				<td/>
                <td><t t-esc=" '%sh %02dm'  %(str((salida-meal_end)).split('.')[0], int(float(str((salida-meal_end)).split('.')[1][:2])/100*60))"/></td>
				<td><span t-esc="'%.2f' % (salida-meal_end)"/></td>
				<t t-set="ht" t-value="ht+(salida-meal_end)"/>
			</tr>
		</t>

		<!-- METODO PRECISO 00 -->
		<!--<t t-if="not o['meal'] and not o['lunch']">
        		<td><t t-esc=" '%s:%02d'  %(str(o['salida']).split('.')[0], int(round(float(str('%.2f' % o['salida']).split('.')[1])/100*60)))"/></td>
        		<td/>
        		<td><span t-esc="o['salida']-o['entrada']"/></td>
        		<t t-set="ht" t-value="ht+(o['salida']-o['entrada'])"/>
        		<tr/>
		</t>-->

        <!-- METODO RANDOM -->
		<t t-if="not o['meal'] and not o['lunch']">
                <td><t t-esc=" '%s:%02d'  %(str(salida).split('.')[0], int(float(str(salida).split('.')[1][:2])/100*60))"/></td>
        		<td/>
                
                <td><t t-esc=" '%sh %02dm'  %(str((salida-entrada)).split('.')[0], int(float(str((salida-entrada)).split('.')[1][:2])/100*60))"/></td>
        		<!--<td><span t-esc=" '%.2f' % (salida-entrada)"/></td>-->
        		<t t-set="ht" t-value="ht+(salida-entrada)"/>
        		<tr/>
		</t>

	</t>
	</tbody>
	<!--<tbody>
        <t t-set="ht" t-value="0"/>
        <t t-foreach="data['attendances']" t-as="o">
	        <td><span t-esc="o['day']"></span></td>
		<td><t t-esc=" '%s:%02d'  %(str(o['entrada']).split('.')[0], int(round(float(str('%.2f' % o['entrada']).split('.')[1])/100*60)))"/></td>
		<td></td>
		<t t-if="o['lunch']">
			<td><t t-esc=" '%s:%02d'  %(str(o['lunch_start']).split('.')[0], int(round(float(str('%.2f' % o['lunch_start']).split('.')[1])/100*60)))"/></td>
			<td></td>
			<td><span t-esc="o['lunch_start']-o['entrada']"/></td>
			<t t-set="ht" t-value="ht+(o['lunch_start']-o['entrada'])" />
			<tr>
			        <td><span t-esc="o['day']"></span></td>
				<td><t t-esc=" '%s:%02d'  %(str(o['lunch_end']).split('.')[0], int(round(float(str('%.2f' % o['lunch_end']).split('.')[1])/100*60)))"/></td>
				<td></td>
				<td><t t-esc=" '%s:%02d'  %(str(o['salida']).split('.')[0], int(round(float(str('%.2f' % o['salida']).split('.')[1])/100*60)))"/></td>
				<td></td>
				<td><span t-esc="o['salida']-o['lunch_end']"/></td>
				<t t-set="ht" t-value="ht+(o['salida']-o['lunch_end'])" />


			</tr>
		</t>
		<t t-if="o['meal'] and o['lunch']">
			<t t-if="not o['lunch']">
				<td><t t-esc=" '%s:%02d'  %(str(o['salida']).split('.')[0], int(round(float(str('%.2f' % o['salida']).split('.')[1])/100*60)))"/></td>
			</t>
			<tr>
			        <td><span t-esc="o['day']"></span></td>
				<td><t t-esc=" '%s:%02d'  %(str(o['meal_start']).split('.')[0], int(round(float(str('%.2f' % o['meal_start']).split('.')[1])/100*60)))"/></td>
				<td></td>
				<td><t t-esc=" '%s:%02d'  %(str(o['meal_end']).split('.')[0], int(round(float(str('%.2f' % o['meal_end']).split('.')[1])/100*60)))"/></td>
				<td></td>
				<td><span t-esc="o['meal_end']-o['meal_start']"/></td>
				<t t-set="ht" t-value="ht+(o['meal_end']-o['meal_start'])" />

			</tr>
		</t>		
		<t t-if="not o['meal'] and not o['lunch']">
        		<td><t t-esc=" '%s:%02d'  %(str(o['salida']).split('.')[0], int(round(float(str('%.2f' % o['salida']).split('.')[1])/100*60)))"/></td>
        		<td></td>
        		<td><span t-esc="o['salida']-o['entrada']"></span></td>
        		<t t-set="ht" t-value="ht+(o['salida']-o['entrada'])"/>
        		<tr></tr>
		</t>
	</t>
	</tbody>-->
        	<!--<td><span t-esc="o['check_in'][8:10]"></span></td>
            <td><span t-esc="o['check_in'][11:]"/></td>
            <td></td>
            <td><span t-esc="o['check_out'][11:]"/></td>
            <td></td>-->
            <!--<t t-set="ht" t-value="ht+o['worked_hours']"/>
            <td><span t-esc=" '%s:%02d'  %(str(o['worked_hours']).split('.')[0], int(round(float(str('%.2f' % o['worked_hours']).split('.')[1])/100*60)))"/></td>
            <tr/>
        </t>
    	</tbody>-->

      <tfoot>
        <td/>
        <td/>
        <td/>
        <td>Total worked hours</td>
        <td style="align:left;">
		<!--<td><t t-esc="'%.2f' % ht"/></td>-->
        <td><t t-esc=" '%sh %02dm'  %(str(ht).split('.')[0], int(float(str(ht).split('.')[1][:2])/100*60))"/></td>

	</td>
	</tfoot>
	<!--<tfoot>
        <td/>
        <td/>
        <td/>
        <td>Total worked hours</td>
        <td style="align:left;">
		<td><t t-esc="ht"/></td>
	</td>
			</tfoot>-->
			</table>
			<div class="container">
					<div style="display: inline-block; font-size: 12px;background: #DBDBDB;width 25%; margin-left: 80px;">Employee sign</div>
					<div style="display: inline-block; font-size: 12px;width: 50%"/>
					<div style="display: inline-block; font-size: 12px;background: #DBDBDB;width 25%;margin-top: 50px;">Company sign</div>
			</div>
							
</div>
</t>

</t>
</template>

<template id="report_assistance_period">
    <t t-call="report.html_container">
      <t t-foreach="doc_ids" t-as="doc_id">
            <t t-raw="translate_doc(doc_id, doc_model, 'company_id.partner_id.lang', 'ib_report_attendance_w.report_assistance_period_document')"/>
      </t>
    </t>
</template>

</data>
</openerp>



